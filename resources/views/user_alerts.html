<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChaseProfit - –ú–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-bg: #0e0e0e;
            --secondary-bg: #1a1a1a;
            --accent-color: #00c087;
            --accent-hover: #00a871;
            --text-primary: #ffffff;
            --text-secondary: #848e9c;
            --border-color: #2a2a2a;
            --positive: #00c087;
            --negative: #f6465d;
            --card-bg: #151515;
            --chart-bg: #121212;
            --alert-info: #3498db;
            --alert-warning: #f39c12;
            --alert-success: #2ecc71;
            --alert-error: #e74c3c;
        }

        [data-theme="light"] {
            --primary-bg: #ffffff;
            --secondary-bg: #f8f9fa;
            --accent-color: #00c087;
            --accent-hover: #00a871;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --positive: #00c087;
            --negative: #f6465d;
            --card-bg: #ffffff;
            --chart-bg: #f8f9fa;
            --alert-info: #3498db;
            --alert-warning: #f39c12;
            --alert-success: #2ecc71;
            --alert-error: #e74c3c;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .header {
            background: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 0 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-item {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .nav-item:hover, .nav-item.active {
            color: var(--text-primary);
            background: var(--card-bg);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 14px;
        }

        .btn-login {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-register {
            background: var(--accent-color);
            color: var(--primary-bg);
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn-register:hover {
            background: var(--accent-hover);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 20px;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            color: var(--text-primary);
            background: var(--card-bg);
        }

        .main-content {
            margin-top: 64px;
            min-height: calc(100vh - 64px);
            padding: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .page-subtitle {
            color: var(--text-secondary);
            margin-top: 10px;
            font-size: 1.1rem;
        }

        .alerts-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-input {
            padding: 10px 15px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            min-width: 250px;
        }

        .filter-select {
            padding: 10px 15px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
        }

        .alerts-container {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .alert-card {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .alert-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-color);
        }

        .alert-card.unread {
            border-left: 4px solid var(--accent-color);
        }

        .alert-card.silent {
            opacity: 0.7;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .alert-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            background: var(--accent-color);
            color: white;
        }

        .alert-type.alerts {
            background: var(--alert-info);
        }

        .alert-type.warning {
            background: var(--alert-warning);
        }

        .alert-type.success {
            background: var(--alert-success);
        }

        .alert-type.error {
            background: var(--alert-error);
        }

        .alert-meta {
            display: flex;
            gap: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .alert-id {
            font-family: monospace;
            background: var(--secondary-bg);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .alert-message {
            font-size: 1.1rem;
            line-height: 1.6;
            margin: 20px 0;
            padding: 20px;
            background: var(--secondary-bg);
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
        }

        .alert-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .alert-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-mark-read {
            background: var(--secondary-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-delete {
            background: var(--negative);
            color: white;
        }

        .alert-time {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .empty-state-message {
            max-width: 500px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        .notification-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--negative);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            color: var(--text-secondary);
            gap: 10px;
        }

        .loading-spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .page-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .alerts-controls {
                flex-direction: column;
                width: 100%;
            }

            .search-input {
                width: 100%;
            }

            .alert-header {
                flex-direction: column;
                gap: 10px;
            }

            .alert-footer {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .alert-meta {
                flex-direction: column;
                gap: 5px;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="header">
    <div class="nav-container">
        <div class="logo">
            <span>‚ö°</span>
            ChaseProfit
        </div>
        <nav class="nav-menu">
            <a href="/user_alerts" class="nav-item active">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="/vallets" class="nav-item">–í–∞–ª—é—Ç—ã</a>
            <a href="/about_us" class="nav-item">–û –Ω–∞—Å</a>
            <a href="/analyze_settings" class="nav-item">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞</a>
        </nav>
        <div class="nav-actions">
            <button class="theme-toggle" id="themeToggle">üåô</button>
            <button class="btn btn-login"><a href="/auth" style="color: inherit; text-decoration: none;">–í–æ–π—Ç–∏</a></button>
            <button class="btn btn-register"><a href="/register" style="color: inherit; text-decoration: none;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></button>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <div class="page-header">
        <div>
            <h1 class="page-title">–ú–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
            <p class="page-subtitle">–¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
        <div class="alerts-controls">
            <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...">
            <select class="filter-select" id="filterSelect">
                <option value="all">–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</option>
                <option value="unread">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</option>
                <option value="alerts">–¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</option>
            </select>
            <button class="btn btn-register" id="markAllReadBtn">–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</button>
        </div>
    </div>

    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-value" id="totalAlerts">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="unreadAlerts">0</div>
            <div class="stat-label">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="todayAlerts">0</div>
            <div class="stat-label">–°–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="tradeSignals">0</div>
            <div class="stat-label">–¢–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</div>
        </div>
    </div>

    <div class="alerts-container" id="alertsContainer">
        <div class="loading">
            <div class="loading-spinner"></div>
            <span>–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...</span>
        </div>
    </div>
</main>

<script>
    // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
    let alertsData = [];
    let filteredAlerts = [];

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing alerts page...');
        initializeTheme();
        loadAlertsData();
        setupEventListeners();
    });

    // ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ==========
    async function loadAlertsData() {
        try {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç fetch –∑–∞–ø—Ä–æ—Å –∫ API
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const sampleData = {
                "alerts": [
                    {
                        "id": 1047,
                        "userId": "daaaa@yandex.ru",
                        "title": "–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
                        "message": "üìà –ë–´–ß–ò–ô | BTC | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: 84 | –¶–ï–ù–ê: 89650.7 | TP: 89738 | SL: 89516",
                        "type": "alerts",
                        "silent": false,
                        "read": false,
                        "timestamp": new Date(Date.now() - 3600000).toISOString() // 1 —á–∞—Å –Ω–∞–∑–∞–¥
                    },
                    {
                        "id": 1048,
                        "userId": "daaaa@yandex.ru",
                        "title": "–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!!",
                        "message": "üìà –ë–´–ß–ò–ô | ETH | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: 91 | –¶–ï–ù–ê: 3114.87 | TP: 3113.326845 | SL: 3113.240546",
                        "type": "alerts",
                        "silent": false,
                        "read": false,
                        "timestamp": new Date(Date.now() - 7200000).toISOString() // 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥
                    },
                    {
                        "id": 1049,
                        "userId": "daaaa@yandex.ru",
                        "title": "–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
                        "message": "üìà –ë–´–ß–ò–ô | BTC | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: 82 | –¶–ï–ù–ê: 90207.5 | TP: 90305.689153 | SL: 90148.141147",
                        "type": "alerts",
                        "silent": false,
                        "read": true,
                        "timestamp": new Date(Date.now() - 86400000).toISOString() // 1 –¥–µ–Ω—å –Ω–∞–∑–∞–¥
                    }
                ]
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            for (let i = 1050; i <= 1060; i++) {
                const types = ['alerts', 'warning', 'success', 'error'];
                const coins = ['BTC', 'ETH', 'SOL', 'ADA', 'XRP', 'BNB', 'DOGE'];
                const trend = Math.random() > 0.5 ? 'üìà –ë–´–ß–ò–ô' : 'üìâ –ú–ï–î–í–ï–ñ–ò–ô';
                const coin = coins[Math.floor(Math.random() * coins.length)];
                const probability = Math.floor(Math.random() * 30) + 70;
                const price = (Math.random() * 100000).toFixed(2);
                const tp = (parseFloat(price) * (1 + Math.random() * 0.05)).toFixed(6);
                const sl = (parseFloat(price) * (1 - Math.random() * 0.03)).toFixed(6);

                sampleData.alerts.push({
                    "id": i,
                    "userId": "daaaa@yandex.ru",
                    "title": `–¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª ${i-1049}`,
                    "message": `${trend} | ${coin} | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${probability} | –¶–ï–ù–ê: ${price} | TP: ${tp} | SL: ${sl}`,
                    "type": types[Math.floor(Math.random() * types.length)],
                    "silent": Math.random() > 0.8,
                    "read": Math.random() > 0.5,
                    "timestamp": new Date(Date.now() - Math.random() * 604800000).toISOString() // —Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é
                });
            }

            alertsData = sampleData.alerts;
            filteredAlerts = [...alertsData];

            updateStats();
            renderAlerts();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            localStorage.setItem('alertsData', JSON.stringify(alertsData));

        } catch (error) {
            console.error('Error loading alerts:', error);
            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
        }
    }

    // ========== –†–ï–ù–î–ï–†–ò–ù–ì –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ==========
    function renderAlerts() {
        const container = document.getElementById('alertsContainer');

        if (filteredAlerts.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üîî</div>
                    <h2 class="empty-state-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ—Ç</h2>
                    <p class="empty-state-message">
                        –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞—à–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è.
                        –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
                    </p>
                    <button class="btn btn-register" onclick="window.location.href='/analyze_settings'">
                        –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                    </button>
                </div>
            `;
            return;
        }

        container.innerHTML = filteredAlerts.map(alert => {
            const date = new Date(alert.timestamp);
            const timeAgo = getTimeAgo(date);
            const isToday = isDateToday(date);

            return `
                <div class="alert-card ${alert.read ? '' : 'unread'} ${alert.silent ? 'silent' : ''}">
                    ${!alert.read ? '<div class="notification-badge">!</div>' : ''}

                    <div class="alert-header">
                        <div>
                            <h3 class="alert-title">
                                ${alert.title}
                                <span class="alert-type ${alert.type}">${getTypeLabel(alert.type)}</span>
                            </h3>
                            <div class="alert-meta">
                                <span class="alert-id">ID: ${alert.id}</span>
                                <span>${timeAgo}</span>
                                ${isToday ? '<span style="color: var(--accent-color)">‚ú¶ –°–µ–≥–æ–¥–Ω—è</span>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="alert-message">
                        ${formatAlertMessage(alert.message)}
                    </div>

                    <div class="alert-footer">
                        <div class="alert-actions">
                            ${!alert.read ? `
                                <button class="btn btn-small btn-mark-read" onclick="markAsRead(${alert.id})">
                                    ‚úì –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
                                </button>
                            ` : ''}
                            <button class="btn btn-small btn-delete" onclick="deleteAlert(${alert.id})">
                                ‚úï –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                        <div class="alert-time">
                            ${date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            })}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function formatAlertMessage(message) {
        // –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const parts = message.split(' | ');
        return parts.map(part => {
            if (part.includes('–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:')) {
                const prob = part.match(/\d+/)?.[0];
                return `<span style="color: ${getProbabilityColor(prob)}">${part}</span>`;
            }
            if (part.includes('–¶–ï–ù–ê:')) {
                return `<strong>${part}</strong>`;
            }
            if (part.includes('TP:') || part.includes('SL:')) {
                const [label, value] = part.split(': ');
                const color = label === 'TP:' ? 'var(--positive)' : 'var(--negative)';
                return `<span style="color: ${color}">${label} <strong>${value}</strong></span>`;
            }
            return part;
        }).join(' | ');
    }

    function getProbabilityColor(probability) {
        const prob = parseInt(probability);
        if (prob >= 80) return 'var(--positive)';
        if (prob >= 60) return 'var(--alert-warning)';
        return 'var(--negative)';
    }

    function getTypeLabel(type) {
        const labels = {
            'alerts': '–°–∏–≥–Ω–∞–ª',
            'warning': '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',
            'success': '–£—Å–ø–µ—Ö',
            'error': '–û—à–∏–±–∫–∞'
        };
        return labels[type] || type;
    }

    function getTimeAgo(date) {
        const now = new Date();
        const diff = now - date;

        const minute = 60 * 1000;
        const hour = 60 * minute;
        const day = 24 * hour;

        if (diff < minute) return '–¢–æ–ª—å–∫–æ —á—Ç–æ';
        if (diff < hour) return `${Math.floor(diff / minute)} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
        if (diff < day) return `${Math.floor(diff / hour)} —á. –Ω–∞–∑–∞–¥`;
        if (diff < 7 * day) return `${Math.floor(diff / day)} –¥–Ω. –Ω–∞–∑–∞–¥`;

        return date.toLocaleDateString('ru-RU');
    }

    function isDateToday(date) {
        const today = new Date();
        return date.getDate() === today.getDate() &&
            date.getMonth() === today.getMonth() &&
            date.getFullYear() === today.getFullYear();
    }

    // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –ü–û–ò–°–ö ==========
    function filterAlerts() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filterValue = document.getElementById('filterSelect').value;

        filteredAlerts = alertsData.filter(alert => {
            // –ü–æ–∏—Å–∫
            const matchesSearch = !searchTerm ||
                alert.title.toLowerCase().includes(searchTerm) ||
                alert.message.toLowerCase().includes(searchTerm);

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            let matchesFilter = true;
            switch(filterValue) {
                case 'unread':
                    matchesFilter = !alert.read;
                    break;
                case 'alerts':
                    matchesFilter = alert.type === 'alerts';
                    break;
            }

            return matchesSearch && matchesFilter;
        });

        renderAlerts();
        updateStats();
    }

    // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==========
    function updateStats() {
        const total = alertsData.length;
        const unread = alertsData.filter(a => !a.read).length;
        const today = alertsData.filter(a => isDateToday(new Date(a.timestamp))).length;
        const tradeSignals = alertsData.filter(a => a.type === 'alerts').length;

        document.getElementById('totalAlerts').textContent = total;
        document.getElementById('unreadAlerts').textContent = unread;
        document.getElementById('todayAlerts').textContent = today;
        document.getElementById('tradeSignals').textContent = tradeSignals;
    }

    // ========== –î–ï–ô–°–¢–í–ò–Ø –° –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø–ú–ò ==========
    function markAsRead(alertId) {
        const alert = alertsData.find(a => a.id === alertId);
        if (alert) {
            alert.read = true;
            saveAlertsData();
            filterAlerts();
            showNotification('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ', '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ');
        }
    }

    function markAllAsRead() {
        alertsData.forEach(alert => alert.read = true);
        saveAlertsData();
        filterAlerts();
        showNotification('–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω—ã', '–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ');
    }

    function deleteAlert(alertId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?')) {
            alertsData = alertsData.filter(a => a.id !== alertId);
            saveAlertsData();
            filterAlerts();
            showNotification('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—ã–ª–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ');
        }
    }

    function saveAlertsData() {
        localStorage.setItem('alertsData', JSON.stringify(alertsData));
    }

    // ========== –¢–ï–ú–ù–ê–Ø/–°–í–ï–¢–õ–ê–Ø –¢–ï–ú–ê ==========
    function initializeTheme() {
        const themeToggle = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme') || 'dark';

        document.documentElement.setAttribute('data-theme', currentTheme);
        updateThemeButton(currentTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        });
    }

    function updateThemeButton(theme) {
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }

    // ========== EVENT LISTENERS ==========
    function setupEventListeners() {
        document.getElementById('searchInput').addEventListener('input', filterAlerts);
        document.getElementById('filterSelect').addEventListener('change', filterAlerts);
        document.getElementById('markAllReadBtn').addEventListener('click', markAllAsRead);
    }

    // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
    function showNotification(title, message) {
        const notification = document.createElement('div');
        notification.className = 'notification-toast show';
        notification.innerHTML = `
            <div class="notification-header">
                <div class="notification-title">${title}</div>
                <div class="notification-time">–¢–æ–ª—å–∫–æ —á—Ç–æ</div>
            </div>
            <div class="notification-message">${message}</div>
        `;

        notification.style.cssText = `
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--accent-color);
            border-radius: 8px;
            padding: 15px;
            max-width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateX(0);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            cursor: pointer;
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.transform = 'translateX(400px)';
            setTimeout(() => notification.remove(), 500);
        }, 5000);

        notification.addEventListener('click', function() {
            this.style.transform = 'translateX(400px)';
            setTimeout(() => this.remove(), 500);
        });
    }

    function showError(message) {
        const container = document.getElementById('alertsContainer');
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">‚ö†Ô∏è</div>
                <h2 class="empty-state-title">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                <p class="empty-state-message">${message}</p>
                <button class="btn btn-register" onclick="loadAlertsData()">
                    –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
                </button>
            </div>
        `;
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞)
    function getCookie(name) {
        let matches = document.cookie.match(new RegExp(
            "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ));
        return matches ? decodeURIComponent(matches[1]) : undefined;
    }

    function updateAuthButtons() {
        const userCookie = getCookie('user');
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    }
</script>
</body>
</html>